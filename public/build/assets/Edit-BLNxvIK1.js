import{q as N,r as u,W as y,j as e,Y as k,a as w}from"./app-CU81j7nS.js";import{A as C,m as F}from"./AuthenticatedLayout-dRBKfQCh.js";import{P as E}from"./PrimaryButton-B91Wo0_j.js";import{n as d}from"./index-CRzonMBn.js";import{d as S}from"./index-W5QgHgs8.js";import"./ApplicationLogo-CKQckDiy.js";import"./transition-CyRQxhFf.js";import"./SecondaryButton-BoGYldyN.js";function M(){const{course:o,flash:l}=N().props,x=F.name;u.useEffect(()=>{l.success&&d.success(l.success),l.error&&d.error(l.error)},[l]);const{data:i,setData:n,post:b,errors:t}=y({id:o.id,name:o.name,description:o.description,price_usd:o.price_usd,price_i_coin:o.price_i_coin,number_of_videos:o.number_of_videos,video_links:o.videos.map(s=>s.link)||[],files:[],existing_files:o.existing_files||[]}),[p,h]=u.useState(o.number_of_videos);u.useEffect(()=>{h(o.number_of_videos)},[o.number_of_videos]);const f=s=>{s.preventDefault();const r=new FormData;r.append("id",i.id),r.append("name",i.name),r.append("description",i.description),r.append("price_usd",i.price_usd),r.append("price_i_coin",i.price_i_coin),r.append("number_of_videos",i.number_of_videos);const c=i.video_links.map(a=>({link:a}));r.append("videos",JSON.stringify(c));for(let a=0;a<i.files.length;a++)r.append("files[]",i.files[a]);b(`/courses/${i.id}`,{data:r,headers:{"Content-Type":"multipart/form-data"},onSuccess:a=>{n(m=>({...m,...a.course})),d.success("Cours mis à jour avec succès !")},onError:a=>{l.error?d.error(l.error):Object.values(a).forEach(m=>{d.error(m)})}})},_=s=>{n("files",s.target.files)},v=s=>{const r=s.target.value;h(r),n("number_of_videos",r)},j=()=>Array.from({length:p},(s,r)=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-gray-700",htmlFor:`video_link_${r}`,children:["Lien de la Vidéo ",r+1]}),e.jsx("input",{type:"text",id:`video_link_${r}`,value:i.video_links[r]||"",onChange:c=>{const a=[...i.video_links];a[r]=c.target.value,n("video_links",a)},className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0})]},r)),g=s=>{confirm("Êtes-vous sûr de vouloir supprimer ce fichier ?")&&S.Inertia.delete(`/courses/${i.id}/files/${s}/delete`,{onSuccess:()=>{l.success?d.success(l.success):d.success("Fichier supprimé avec succès !")},onError:r=>{l.error?d.error(l.error):Object.values(r).forEach(c=>{d.error(c)})}})};return e.jsxs(C,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Modifier la Formation"}),children:[e.jsx(k,{title:"Modifier un Cours"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6 bg-white border-b border-gray-200",children:e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",htmlFor:"name",children:"Nom de la Formation"}),e.jsx("input",{type:"text",id:"name",value:i.name,onChange:s=>n("name",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0}),t.name&&e.jsx("div",{className:"text-red-500",children:t.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",value:i.description,onChange:s=>n("description",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0}),t.description&&e.jsx("div",{className:"text-red-500",children:t.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",htmlFor:"price_usd",children:"Prix en USD"}),e.jsx("input",{type:"number",id:"price_usd",value:i.price_usd,onChange:s=>n("price_usd",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0}),t.price_usd&&e.jsx("div",{className:"text-red-500",children:t.price_usd})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-gray-700",htmlFor:"price_i_coin",children:["Prix en ",x]}),e.jsx("input",{type:"number",id:"price_i_coin",value:i.price_i_coin,onChange:s=>n("price_i_coin",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",required:!0}),t.price_i_coin&&e.jsx("div",{className:"text-red-500",children:t.price_i_coin})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",htmlFor:"number_of_videos",children:"Nombre de Vidéos"}),e.jsx("input",{type:"number",id:"number_of_videos",value:p,onChange:v,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",min:"0",required:!0}),t.number_of_videos&&e.jsx("div",{className:"text-red-500",children:t.number_of_videos})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Liens des Vidéos"}),j()]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",htmlFor:"files",children:"Fichiers"}),e.jsx("input",{type:"file",id:"files",onChange:_,multiple:!0,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Fichiers Existants"}),e.jsx("ul",{className:"mb-4",children:i.existing_files.map(s=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s.file_name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:`/storage/${s.file_path}`,className:"text-blue-500 hover:underline",download:!0,children:"Télécharger"}),e.jsx("button",{type:"button",onClick:()=>g(s.id),className:"text-red-500 hover:underline",children:"Supprimer"})]})]},s.id))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{href:"/courses",className:"text-gray-600 hover:text-gray-800 underline",children:"Annuler"}),e.jsx(E,{type:"submit",children:"Mettre à jour le Cours"})]})]})})})})})]})}export{M as default};
